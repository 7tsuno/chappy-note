# 勉強ノートApps構想メモ（2025-11-08）

## 1. プロダクト概要
- ChatGPT上での学習対話をMarkdownノートに整形・保存し、後から検索・再編集できるAppsを目指す。
- 初期データストアはMCPサーバーローカルのファイルシステム（例: `data/notes/<noteId>.md` + `notes.json`）。将来はDB化し、他アプリからも参照可能にする前提でAPI設計を意識する。
- MCPサーバーはNgrok経由でChatGPTに公開し、Reactウィジェット + Node MCPサーバーの二層構成。

## 2. MVPゴール
1. ChatGPTに「まとめてノートに保存して」と依頼すると、Appsが会話文脈＋ユーザー追記内容をMarkdown化して保存できる。
2. UIまたはチャット経由で既存ノートを編集・追記できる（履歴管理は不要）。
3. タグ自動付与＋手動編集、タグフィルタと最新順ソートでノート一覧を表示できる。
4. 「前に学んだ○○って？」と尋ねると、タグ/全文検索で該当ノートを提示し、要約＋引用を返す。

## 3. 想定ユーザーフロー
1. **保存フロー**
   - チャットで学習 → ユーザーが保存指示 → GPTがノート案（タイトル/本文/タグ）を生成しUIに表示。
   - ユーザーがUIで微修正 or チャットで「タイトルを〜に」「この段落を追記」等と指示 → 確定後にローカルへ書き出し。
   - 保存時に表示するエディタは閲覧時の編集エディタと共通化し、同じUI/操作感で初版作成と後続の追記を扱う。
2. **閲覧・参照フロー**
   - ノート一覧ウィジェットでタグ選択 or 検索ワード入力 → 結果を最新更新順で表示 → 1件を開いて本文を参照。
   - 「編集」ボタンでUI内エディタを開き、保存するとファイル更新。チャットからの追記指示にも対応。
3. **検索フロー**
   - チャットで質問 → Appsがタグ一致＋全文検索で候補ノートを取得 → 要約を返答、ユーザーが「開いて」と指示するとUIへフォーカス。

## 4. データモデル（MVP）
```json
{
  "id": "uuid",
  "title": "文字列",
  "contentPath": "data/notes/<uuid>.md",
  "tags": ["文字列"],
  "sourceConversationId": "chatgpt-session-id",
  "createdAt": "ISO",
  "updatedAt": "ISO"
}
```
- `tags`はGPTが初期自動付与。UIで追加/削除可能。
- `contentPath`配下のMarkdownに本文 + 生成SVG（`![図](figures/<uuid>.svg)`）を格納。MVPではSVG生成はオプション。

## 5. 機能要件
- **ノート生成**: 会話文脈＋ユーザー指定コンテキストをstructuredContentで受け取り、Markdownテンプレを適用して保存。
- **編集**: UI内のMarkdownエディタ（簡易で可）とチャット指示の両方をサポート。差分プレビューはスコープ外。
  - 保存フローと閲覧フローが同じReactコンポーネントを用いる前提で、共通のフォーム/バリデーション/タグ編集UIを備える。
- **検索**: まずタグフィルタ（AND/OR指定はMVP審議）、次に全文検索（`ripgrep`等でmdファイルを走査）。
- **参照応答**: ChatGPT上の回答ではヒットノートのタイトル・タグ・要約・引用リンクを提示。
- **タグ管理**: 保存時に自動提案を行い、UIで削除・追加し再保存。

## 6. 非機能要件
- ローカルファイルIOの整合性確保（書き込み時にテンポラリ→アトミック rename）。
- Ngrok公開URLのシークレット管理、Basic Auth等で最低限の保護。
- Markdown/タグJSONはGitで追跡できるようUTF-8/改行統一。

## 7. 今後の検討（MVP以降）
- DB移行とGraphQL/REST API提供、他アプリ連携。
- SVG生成の自動化、Mermaid等のプレビューサポート。
- バージョン履歴、差分プレビュー、共有リンク機能。

## 8. 次のステップ（タスク分解ラフ案）
1. モノレポ雛形作成（pnpm workspace / packages/widget + packages/mcp-server + shared）。
2. Node MCPサーバープロトタイプで`/notes:list` `notes:create` `notes:update` `notes:search`ツールを定義。
3. ファイルストアモジュール実装（MD書き込み、メタJSON管理、タグ自動生成ダミー）。
4. Reactウィジェット雛形（ノート一覧、詳細、編集フォーム、ChatGPTブリッジ）を実装。
5. Ngrok経由でDeveloper Mode接続し、保存→参照のE2Eを確認。
6. タグ自動付与プロンプトと全文検索処理をブラッシュアップ。
