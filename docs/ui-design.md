# 画面設計書

## 1. 画面一覧
| 画面 | 目的 | 主要要素 |
| --- | --- | --- |
| ダッシュボード/一覧 | タグフィルタ＋最新順でノートを探索 | タグチップ, 検索入力, ノートカード, 新規作成ボタン |
| ノート詳細 | 1件のノートを閲覧し編集やチャット質問に遷移 | タイトル, メタ情報, Markdown本文, CTA（編集/チャットで質問/タグ編集） |
| 共通ノートエディタ | 新規保存/既存編集を同UIで実施 | タイトル入力, タグ入力（自動提案表示）, Markdownエディタ, 保存/キャンセル |
| 検索結果カード（チャット） | チャット質問に対する上位ノート提示 | タイトル, タグ, 抜粋, 「開く」アクション |

## 2. UI構造
- `WidgetShell`
  - `Header`: アプリ名、最終同期時刻、タグフィルタ。テーマ切替に合わせてCSS変数更新。
  - `Main`: Routerで一覧/詳細/エディタを切替。
  - `Footer`: ショートカット、Storybookレビューリンク。

## 3. 主要コンポーネント仕様
### 3.1 TagFilter
- チップ複数選択。クリックでON/OFF、選択中タグは`notes.search`の`tags`引数に反映。
- Story: (a)選択無し (b)複数選択 (c)タグ無し時のEmpty。

### 3.2 NoteCard
- 要素: タイトル, 更新日時, 最大3タグ, 抜粋（80文字）, CTA「開く」。
- 状態: 通常/ローディング/エラー/ハイライト（検索ヒット）。

### 3.3 NoteDetail
- Markdown表示は`react-markdown` + シンタックスハイライト。
- Headerに「編集」「チャットで質問」「タグ編集」ボタン。

### 3.4 NoteEditor
- タイトル: 必須、50文字制限。
- タグ: 自動提案（GPT初期値）をチップで表示し、手動追加入力はEnterベース。
- Markdown: シンプルなテキストエリア（MVP）。将来はプレビュータブ追加。
- 保存: `callTool(notes.create|update)`。保存中はスピナーとボタン無効化。

## 4. ステート管理
- グローバル: `structuredContent`を`useStructuredContentState`で保持。
- ビュー切替: `view = 'list' | 'detail' | 'editor'` をZustand/Contextで管理。
- エディタDraft: `window.openai.setWidgetState` で永続化し、チャットフォローアップでも復元。

## 5. Storybook方針
- `stories/`配下で画面ごとにStoriesを用意。
- Decoratorで `OpenAiBridgeContext` とテーマ変数をモック。
- レビューのたびに最新Story URL/スクショを共有。

## 6. ナビゲーションフロー
1. 初期表示 → 一覧（タグ/検索操作）。
2. ノート選択 → 詳細。詳細からは編集orチャット質問。
3. 新規作成 or 「保存して」リクエスト → Draft Editor → 保存成功で詳細ビューへ戻る。

## 7. バリデーション/エラーパターン
- タイトル未入力、タグ過多（5件超）、本文空 → in-placeメッセージ。
- 保存失敗 → Toastで再試行案内。
- 検索0件 → Empty stateカードでタグ解除を提案。

## 8. アクセシビリティ
- フォーカスリングを明示、キーボード操作でタグ追加/削除可能。
- 色コントラスト比 4.5:1 以上を目標。
- ライブリージョンで保存/エラー通知を読み上げ。
