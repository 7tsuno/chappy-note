# 009: チャット検索応答フロー

## 目的
- 「前に学んだ○○は？」といったチャット指示に応じて、サーバー検索→結果整形→ユーザー返信までを自動化するフローを整える。

## スコープ
- `notes.search`の結果をもとに、ChatGPTのレスポンス用テキスト/structuredContentを生成。
- 引用/要約テンプレート、関連ノートのリンク化。
- 検索結果がない場合のリカバリメッセージ。

## 完了条件
- ChatGPT上でユーザーが質問すると、Appsが自動で検索し、上位結果の要約とノートを開くCTAを返信できる。
- レスポンスにはタイトル・タグ・抜粋・メモIDなどが含まれ、ユーザーが「開いて」で該当ノートをUIに表示できる。
- エラー/無ヒット時のFallbackメッセージが定義済み。

## 作業リスト
1. MCPサーバーで検索レスポンス→structuredContentの整形ロジックを実装し、最大N件の結果カードを構築。
2. ChatGPT応答用のテキストテンプレート（例: 上位3件を箇条書きで説明）を用意し、`content`フィールドに挿入。
3. 結果カードには「Open note」などのActionを含め、ユーザー操作時に`notes.open`相当のstructuredContentを送る。
4. ユーザー指定タグやキーワードがゼロ件だった場合の再検索提案メッセージを実装。
5. ログに検索ワード/ヒット件数を記録し、デバッグしやすくする。
