# 005: タグ自動付与と検索基盤

## 目的
- ノート保存時のタグ自動生成と、タグフィルタ＋全文検索機能を実装し、ChatGPT/ウィジェット双方で再利用できる検索APIを提供する。

## スコープ
- GPTが提案したタグリストを正規化・重複排除するロジック。
- タグフィルタ（単一/複数）と全文検索キーワードを扱う検索API。
- 将来の高度化（BM25/ベクトル検索）を見据えた抽象化。

## 完了条件
- `notes.generateDraft`または`notes.create`の中でタグ自動付与が行われ、UIが編集できる初期値が返る。
- `notes.search` ツールに `tags` 配列と `query` 文字列を渡すと、タグANDフィルタ+本文ヒットの結果が構造化される。
- 単体テストでタグ正規化・全文検索のケース（ヒット/非ヒット）がカバーされる。

## 作業リスト
1. GPTから受け取るタグ候補文字列を `normalizeTag(name)` で処理（小文字化、スペース/記号の取り扱い、最大長チェック）。
2. タグ自動付与フロー: ChatGPTが生成した下書き内からタグ候補を抽出→サーバー側でバリデーション→最終タグを返却。
3. 検索API: `filterByTags(noteMetas, tags)` と `fullTextSearch(notePaths, query)` を実装し、組み合わせた結果をスコア付けして返す。
4. 検索レスポンスにはハイライト用の抜粋（周辺100文字程度）とタグリストを含め、structuredContentに渡す。
5. テストデータを用意し、タグ/全文検索が期待通り動くことをVitestで確認。
