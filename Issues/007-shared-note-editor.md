# 007: 共通ノートエディタと保存フロー

## 目的
- 新規保存と既存ノート編集の双方で同じUI/UXを提供するMarkdownエディタを実装し、タグ編集と保存リクエストをサーバーに送れるようにする。

## スコープ
- Markdown本文、タイトル、タグのフォーム。
- 自動タグ提案表示＋ユーザーによる追加/削除UI。
- 保存ボタン押下で `notes.create` または `notes.update` ツールを呼ぶ処理。
- Storybookで新規保存と既存編集の2状態を確認できるStoryを提供し、レビューを受けられるようにする。

## 完了条件
- 保存フロー時に生成された下書きがエディタにロードされ、ユーザーが修正→保存できる。
- 既存ノート閲覧時に「編集」ボタンを押すと同エディタに切り替わり、変更後に更新がサーバーに反映される。
- エラー時や保存進行中のトースト/インジケータ表示が実装されている。
- Storybookで初版作成/追記/バリデーションエラーなどの状態が確認でき、レビューに活用できる。

## 作業リスト
1. `NoteEditor` コンポーネントを作り、タイトル/タグ/本文フィールドとバリデーションを実装。
2. タグ入力はチップUIで複数追加・削除ができ、サーバー推奨のタグを初期値として表示。
3. 保存ボタンクリック時に、コンテキストで提供される`callTool`を使って`notes.create`または`notes.update`を呼び、結果structuredContentで一覧/詳細を更新。
4. 保存完了後に通知（例: Toast）を表示し、画面を閲覧ビューへ戻す。
5. エディタ状態を`window.openai.setWidgetState`で永続化し、ChatGPT側からフォローアップが来ても内容が保持されるようにする。
6. StorybookにNoteEditor用のStoriesを追加し、GitHub PR等で参照できるようにする。
